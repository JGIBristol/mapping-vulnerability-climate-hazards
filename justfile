# By default we list all the rules that available
_default:
    @just --list --unsorted

# Build everything from scratch (flooding + heat + vulnerability)
overall: flooding heat vulnerability
    jupyter nbconvert --execute --inplace vulnerability/notebooks/Overall_risk_assessment.ipynb

# Process the flooding hazard exposure data
flooding:
    jupyter nbconvert --execute --inplace hazard/notebooks/Flooding_hazard_analysis.ipynb
    jupyter nbconvert --execute --inplace hazard/notebooks/Flooding_hazard_analysis_disaster.ipynb

# Process the heat hazard exposure data
heat:
    jupyter nbconvert --execute --inplace hazard/notebooks/Heat_hazard_analysis.ipynb

# Download and process the vulnerability data
vulnerability: _resample_and_join
    jupyter nbconvert --execute --inplace vulnerability/notebooks/Developing_vulnerability_indicators.ipynb

# Vulnerability pipeline: download raw data from the internet using the URLs defined in
# data_sources.yaml (skipping any already downloaded data)
_download_data:
    python vulnerability/code/01_download_data.py

# Vulnerability pipeline: extract only data of interest (relating to South Gloucestershire) from zip
# and Shapefiles
_extract_and_subset_data: _download_data
    python vulnerability/code/02_extract_and_subset_data.py

# Vulnerability pipeline: join metrics at each geography level (LSOA, MSOA) into one file
_join_tables: _extract_and_subset_data
    python vulnerability/code/03_join_tables.py

# Vulnerability pipeline: calculate metrics a.k.a. indicators for each area (LSOA, MSOA) using the
# formulae defined in data_sources.yaml
_calculate_indicators: _join_tables
    python vulnerability/code/04_calculate_indicators.py
    
# Vulnerability pipeline: convert all metrics to 2021 LSOAs and join into one file
_resample_and_join: _calculate_indicators
    python vulnerability/code/05_resample_and_join.py

# Export Jupyter Notebooks into static HTML (without running them)
export_notebooks_to_html:
    jupyter nbconvert --to html vulnerability/notebooks/Overall_risk_assessment.ipynb
    jupyter nbconvert --to html hazard/notebooks/Flooding_hazard_analysis.ipynb
    jupyter nbconvert --to html hazard/notebooks/Flooding_hazard_analysis_disaster.ipynb
    jupyter nbconvert --to html hazard/notebooks/Heat_hazard_analysis.ipynb
    jupyter nbconvert --to html vulnerability/notebooks/Developing_vulnerability_indicators.ipynb
