"""
Download raw data from the internet using the URLs defined in `data_sources.yaml` (skipping any
already downloaded data).
"""

from pathlib import Path
import requests

import config


def download_data(url: str, output_file: Path):
    """
    Downloads file from a `url` and saves as `output_file`, if that output file does not already
    exist.
    """
    if not output_file.exists():
        print(f'Downloading {url}...')
        response = requests.get(url)
        response.raise_for_status()
        with output_file.open('wb') as f:
            f.write(response.content)

            
if __name__ == '__main__':
    # Ensure that the directories we are outputting data to exist
    config.raw_data_dir.mkdir(parents=True, exist_ok=True)
    
    # Download the data sources defined in the `data_sources.yaml` config
    for data_source in config.data_sources:
        download_data(
            url=data_source['url'],
            output_file=config.raw_data_dir / config.get_download_filename(data_source),
        )
